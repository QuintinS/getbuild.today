var APICore="http://getbuild.mydevsite.online",APIAuth="http://auth.mydevsite.online",API={Locations:{CheckEmail:APICore+"/user/CheckUser",CheckDomain:APICore+"/Induction/FQDNCheck",UserCreate:APICore+"/Induction/Create",Login:APIAuth+"/Token"}},Stripe={id:"Stripe",Keys:{TestPublishable:"pk_test_xAwJMiXYzWYs2FlhcXLVLX3M",LivePublishable:"pk_live_i85izWOGIij0CQIqFUFDCXIS"},Storage:{Token:null,Coupons:[],Plans:null},API:{Locations:{PlanList:APICore+"/Stripe/Plan",CouponGet:APICore+"/Stripe/Coupon"},getCoupon:function(){var a=$("#CouponCode").val();$.ajax({url:Stripe.API.Locations.CouponGet+"/"+a,beforeSend:function(){$("#CouponCode").prop("disabled",!0),$("#CouponSubmitButton").prop("disabled",!0).removeClass("btn-primary").addClass("btn-default"),$("#CouponSubmitButton").closest(".form-group").find(".form-group").addClass("has-feedback has-info").append('<span class="glyphicon glyphicon-refresh spinning form-control-feedback" aria-hidden="true"></span>')},success:function(a){function b(){Checkout.Storage.PaymentGateway.Storage.Coupons.push(d),Checkout.Functions.addCoupon(d),Checkout.Functions.calculatePaymentTotals(),Framework.UI.NotificationBanner.fire({type:"success",text:"Coupon applied!"})}var c,d=a,e=a.id;if(0===Checkout.Storage.PaymentGateway.Storage.Coupons.length)b();else if(Checkout.Storage.PaymentGateway.Storage.Coupons.length>0){for(var f=0;f<Checkout.Storage.PaymentGateway.Storage.Coupons.length;f++)if(console.log(f),c=Checkout.Storage.PaymentGateway.Storage.Coupons[f].id,e===c)return void Framework.UI.NotificationBanner.fire({type:"warning",text:"Sorry, this coupon has already been applied."});b()}},error:function(){Framework.UI.NotificationBanner.fire({type:"error",text:"Sorry, your coupon code is not valid."})},complete:function(){$("#CouponCode").prop("disabled",!1),$("#CouponCode").val(""),$("#CouponSubmitButton").prop("disabled",!1).addClass("btn-primary").removeClass("btn-default"),$("#CouponSubmitButton").closest(".form-group").find(".form-group").removeClass("has-success has-info has-warning has-error has-feedback").find(".glyphicon").remove()}})},getPlans:function(){$.ajax({url:Stripe.API.Locations.PlanList,headers:{Accept:"Accept: application/json"},success:function(a){Checkout.Storage.PaymentGateway.Storage.Plans=a,Checkout.Storage.PaymentGateway.Functions.populatePlans()}})}},configure:function(){Stripe.StripeHandler=StripeCheckout.configure({key:Stripe.Keys.TestPublishable,token:Stripe.StripeResponseHandler,locale:"auto",image:"/images/stripe-logo.png",name:"Build",description:Checkout.Storage.Plan.name,amount:Checkout.Storage.Plan.amount,email:Checkout.Storage.Billing.RegistrationEmailAddress,opened:function(){},closed:function(){}})},fire:function(){Framework.UI.loadingOverlay.add({text:"Contacting Stripe..."}),Stripe.StripeHandler.open()},StripeHandler:null,StripeResponseHandler:function(a){Stripe.Storage.token=a,Checkout.API.createUser(),Framework.UI.loadingOverlay.add({text:"Setting up your Website..."})},addEventListeners:function(){$(window).on("popstate",function(){Stripe.StripeHandler.close()}),$(window).on("charge.succeeded",function(a){console.log("Charge Succeeded.")})},Functions:{populatePlans:function(){for(var a=Checkout.Storage.PaymentGateway.Storage.Plans,b="",c=0;c<a.length;c++)b=Checkout.Templates.printPricingPlan(a[c])+b;$("#pricingplan-container").empty(),$("#pricingplan-container").html(b)}},reset:function(){Stripe.Storage.token=null,Stripe.Storage.Coupon=[],Stripe.Storage.Affiliate=null,Stripe.Storage.Customer=null,Stripe.Storage.Charge=null,Stripe.Storage.Invoice=null,Stripe.Storage.Balance=null,Stripe.Storage.Event=null,Stripe.addEventListeners()}},Checkout={Storage:{TemplateID:null,EMailAvailable:!1,PricingPlan:{id:null,code:null,name:null,description:null,amount:null},Billing:{},Plans:null,Plan:{name:null,currency:null,created:null,amount:null,interval:null,interval_count:null,livemode:null,statement_descriptor:null,trial_period_days:null,metadata:{description:null,tagline:null},id:null},PaymentGateway:null,Currency:currency.list.USD},API:{captureCreateUserData:function(){var a={Email:Checkout.Storage.Billing.RegistrationEmailAddress,FirstName:Checkout.Storage.Billing.RegistrationFirstName,LastName:Checkout.Storage.Billing.RegistrationLastName,FormalTitle:Checkout.Storage.Billing.RegistrationTitle,CompanyName:Checkout.Storage.Billing.RegistrationCompanyName,DateOfBirth:Checkout.Storage.Billing.RegistrationBirthDate,Country:Checkout.Storage.Billing.RegistrationCountry,Address:Checkout.Storage.Billing.RegistrationAddressLine1+"\n"+Checkout.Storage.Billing.RegistrationAddressLine2+"\n"+Checkout.Storage.Billing.RegistrationCity+"\n"+Checkout.Storage.Billing.RegistrationPostalCode+"\n"+Checkout.Storage.Billing.RegistrationCountry,BillingAddress:Checkout.Storage.Billing.RegistrationAddressLine1+"\n"+Checkout.Storage.Billing.RegistrationAddressLine2+"\n"+Checkout.Storage.Billing.RegistrationCity+"\n"+Checkout.Storage.Billing.RegistrationPostalCode+"\n"+Checkout.Storage.Billing.RegistrationCountry,FQDN:Checkout.Storage.Domain.subdomain+".usebuild.co",AgreeTerms:$("#RegistrationAgreeTerms").is(":checked"),TemplateId:Checkout.Storage.TemplateID,ReferalId:Checkout.Storage.ReferralID,PaymentPlanId:Checkout.Storage.Plan.id};switch(Checkout.Storage.PaymentGateway.id){case"Stripe":a.StripeCharge={amount:Checkout.Storage.Plan.amount,currency:Checkout.Storage.Currency.code||"usd",Token:Stripe.Storage.token.id,description:Checkout.Storage.Plan.name,metadata:{},ChargeNow:!0,statement_descriptor:Checkout.Storage.Plan.name,receipt_email:Checkout.Storage.Billing.RegistrationEmailAddress,destination:null,application_fee:null,shipping:null}}return a},createUser:function(){var a=Checkout.API.captureCreateUserData(),b=JSON.stringify(a);$.ajax({url:API.Locations.UserCreate,headers:{},contentType:"application/json",data:b,method:"post",success:function(){},error:function(){Framework.UI.NotificationBanner.fire({type:"error"}),Framework.UI.loadingOverlay.hide()}})}},Functions:{websiteSignupLogin:function(){var a={grant_type:"password",username:$("#email-exists-message [data-content='EmailAddress']").text(),password:$("#email-exists-message #WebsiteSignupLoginPassword").val()};$.ajax({url:API.Locations.Login,data:a,method:"POST",headers:{Accept:"application/json"},dataType:"json",beforeSend:function(){Framework.UI.loadingOverlay.add({text:"Logging In..."})},success:function(a){console.log(a)},error:function(){Framework.UI.loadingOverlay.hide()}})},keyupDelay:function(){var a=0;return function(b,c){clearTimeout(a),a=setTimeout(b,c)}}(),addCoupon:function(a){console.log(a);var b,c,d,e=a;if(null===e.percent_off&&null!==e.amount_off)b="amount";else{if(null===e.percent_off||null!==e.amount_off)return;b="percentage"}"amount"===b?(c=Number(a.amount_off/100).toFixed(2),d="payment-line-coupon-amount"):"percentage"===b&&(c=a.percent_off,d="payment-line-coupon-percentage");var f=Checkout.Templates.printPaymentLine({type:"coupon",label:"Coupon - "+e.id,couponType:b,value:c,class:""});"percentage"===b?$("#PaymentStatementTable tbody").prepend(f):"amount"===b&&$("#PaymentStatementTable tbody").append(f)},populatePayment:function(){var a,b=$("#PaymentStatementTable"),c=b.find("thead"),d=b.find("tbody"),e=b.find("tfoot");switch(c.empty(),d.empty(),e.empty(),Checkout.Storage.PaymentGateway.id){case"Stripe":a={type:"plan",label:"Build - "+Checkout.Storage.Plan.name,value:Number(Checkout.Storage.Plan.amount/100).toFixed(2)}}var f=Checkout.Templates.printPaymentLine(a);c.append(f);var g=Checkout.Templates.printPaymentLine({type:"total",label:"Total",value:Number(Checkout.Storage.Plan.amount/100).toFixed(2)});e.append(g)},calculatePaymentTotals:function(){var a,b=Checkout.Storage.Plan.amount,c=[],d=[],e=0,f=0;console.log(b),console.log(Checkout.Storage.PaymentGateway.Storage.Coupons.length);for(var g=0;g<Checkout.Storage.PaymentGateway.Storage.Coupons.length;g++)a=Checkout.Storage.PaymentGateway.Storage.Coupons[g],console.log(a),null!==a.amount_off?(d.push(a.amount_off),console.log(d)):null!==a.percent_off&&(c.push(a.percent_off),console.log(c));for(var g=0;g<c.length;g++)e+=c[g],console.log(e);for(var g=0;g<d.length;g++)f+=d[g],console.log(f);switch(b*=(100-e)/100,console.log(b),b-=f,console.log(b),Checkout.Storage.PaymentGateway.id){case"Stripe":b/=100}b=b.toFixed(2),console.log(b),$(".payment-line-total [data-content='LineValue']").text(b)}},Steps:{total:$(".process.step").length,currentStep:0,changeStep:function(a){function b(){d.addClass("step-current step-transitioning"),"next"===a?d.addClass("step-in").removeClass("step-position-right"):"previous"===a&&d.addClass("step-in").removeClass("step-position-left"),setTimeout(function(){d.removeClass("step-transitioning step-in step-out").addClass("step-current")},500)}function c(){e.addClass("step-transitioning").removeClass("step-current"),"next"===a?(e.addClass("step-position-left step-out"),d.addClass("step-position-right")):"previous"===a&&(e.addClass("step-position-right step-out"),d.addClass("step-position-left")),setTimeout(function(){e.removeClass("step-transitioning step-position-left step-position-right step-out step-in")},500)}var d,e=$(".step.step-current");if("next"===a){if(Checkout.Steps.currentStep===Checkout.Steps.total)return;Checkout.Steps.currentStep++,d=$(e).next(".step")}else if("previous"===a){if(0===Checkout.Steps.currentStep)return;Checkout.Steps.currentStep--,d=$(e).prev(".step")}c(),setTimeout(function(){b()},500)}},Forms:{validate:function(){$("#FormUserDetails").validate({rules:{RegistrationFirstName:{required:!0},RegistrationLastName:{required:!0},RegistrationAddressLine1:{required:!0},RegistrationBirthDate:{required:!0},RegistrationCity:{required:!0},RegistrationPostalCode:{required:!0},RegistrationCountry:{required:!0},RegistrationPhoneNumber:{required:!0},RegistrationEmailAddress:{required:!0,email:!0},WebsiteSignupLoginPassword:{required:!0}},messages:{RegistrationFirstName:"Please enter your first name.",RegistrationLastName:"Please enter your last name.",RegistrationAddressLine1:"Please enter your address.",RegistrationAddressLine2:"Please enter your address.",RegistrationBirthDate:{required:"Please enter your birth date"},RegistrationCity:"Please enter your city.",RegistrationPostalCode:"Please enter your postal code.",RegistrationCountry:"Please select your country.",RegistrationPhoneNumber:"Please enter your phone number.",RegistrationEmailAddress:{required:"Please enter your e-mail address.",remote:"Sorry, this e-mail address has already been taken!"},WebsiteSignupLoginPassword:{required:"Please enter your password."}},submitHandler:function(a){if($("#email-exists-message").is(":visible")===!1&&Checkout.Storage.EMailAvailable===!0)Checkout.Storage.Billing={RegistrationTitle:$("#RegistrationTitle").find("option:selected").text(),RegistrationFirstName:$("#RegistrationFirstName").val(),RegistrationLastName:$("#RegistrationLastName").val(),RegistrationPhoneNumber:$("#RegistrationPhoneNumber").val(),RegistrationEmailAddress:$("#RegistrationEmailAddress").val(),RegistrationAddressLine1:$("#RegistrationAddressLine1").val(),RegistrationAddressLine2:$("#RegistrationAddressLine2").val(),RegistrationBirthDate:new Date($("#RegistrationBirthDate").val()),RegistrationCompanyName:$("#RegistrationCompanyName").val(),RegistrationCity:$("#RegistrationCity").val(),RegistrationPostalCode:$("#RegistrationPostalCode").val(),RegistrationCountry:$("#RegistrationCountry").find("option:selected").val()},Checkout.Steps.changeStep("next");else if($("#email-exists-message").is(":visible")===!0&&Checkout.Storage.EMailAvailable===!1){noty({text:'<span class="glyphicon glyphicon-remove">&nbsp;</span><span class="value"><strong>Sorry, an account with this e-mail address already exists.</strong></span>',type:"error",theme:"relax",layout:"bottomCenter",timeout:5e3,animation:{open:"animated fadeInUp",close:"animated fadeOutUp"}})}else if($("#email-exists-message").is(":visible")===!1&&Checkout.Storage.EMailAvailable===!1){noty({text:'<span class="glyphicon glyphicon-remove">&nbsp;</span><span class="value"><strong>Checking e-mail address availability. Please wait.</strong></span>',type:"information",theme:"relax",layout:"bottomCenter",timeout:5e3,animation:{open:"animated fadeInUp",close:"animated fadeOutUp"}})}},errorClass:"error",validClass:"valid",showErrors:generateErrorList}),$("#FormSubdomain").validate({rules:{RegistrationSubdomain:{pattern:"[A-Za-z0-9-]{0,61}",required:!0}},messages:{RegistrationSubdomain:{pattern:"Sorry, this isn't a valid subdomain!",required:"Please enter the subdomain you would like to use."}},errorClass:"error",validClass:"valid",showErrors:generateErrorList,submitHandler:function(){Checkout.Storage.Domain={subdomain:$("#RegistrationSubdomain").val()},Checkout.Steps.changeStep("next")}}),$("#FormCoupon").validate({rules:{CouponCode:{required:!0}},messages:{CouponCode:{required:"Please enter a coupon code."}},errorClass:"error",validClass:"valid",showErrors:generateErrorList,submitHandler:function(){Stripe.API.getCoupon()}})}},addEventListeners:function(){$("#RegistrationEmailAddress").on("keyup",function(){Checkout.EventHandlers.emailAddressKeyUp(),Checkout.Functions.keyupDelay(function(){$("#RegistrationEmailAddress").valid()===!0&&Checkout.EventHandlers.checkEmailAvailable()},500)}),$("#RegistrationSubdomain").on("keyup",function(){Checkout.EventHandlers.domainKeyUp(),Checkout.Functions.keyupDelay(function(){$("#RegistrationSubdomain").valid()===!0&&Checkout.EventHandlers.checkDomainAvailable()},500)}),$("#pricingplan-container").on("click","[data-action='SelectPricingPlan']",function(a){var b=$(a.currentTarget).closest(".pricingplan"),c=b.attr("data-id");$(".pricingplan-container .pricingplan").each(function(){$(this).removeClass("selected unselected"),$(this).find(".btn").removeClass("btn-primary btn-success")}),$("#pricingplan-continue-button").prop("disabled",!1);for(var d,e=0;e<Checkout.Storage.PaymentGateway.Storage.Plans.length;e++)d=$("[data-id='"+Checkout.Storage.PaymentGateway.Storage.Plans[e].id+"']"),Checkout.Storage.PaymentGateway.Storage.Plans[e].id===c?(Checkout.Storage.Plan=Checkout.Storage.PaymentGateway.Storage.Plans[e],d.addClass("selected"),d.find(".btn").addClass("btn-success").text("Selected")):(d.addClass("unselected"),d.find(".btn").addClass("btn-primary").text("Select this Plan"))}),$('[data-action="AddCoupon"]').on("click",Checkout.EventHandlers.expandCouponPanel),$("#pricingplan-continue-button").on("click",function(){Checkout.Storage.PaymentGateway.Storage.Coupons=[],Checkout.Functions.populatePayment(),Checkout.Steps.changeStep("next")}),$("#email-exists-message [data-action='WebsiteSignupSubmit']").on("click",function(){$(WebsiteSignupLoginPassword).valid()===!0?Checkout.Functions.websiteSignupLogin():console.log("Not valid.")}),$("[data-action='PrevStep']").on("click",function(){Checkout.Steps.changeStep("previous")}),$("[data-action='NextStep']").on("click",function(){Checkout.Steps.changeStep("next")}),$("#confirmpay-button-submit").on("click",function(){}),$("#RegistrationAgreeTerms").on("change",function(){$("#confirmpay-button-submit").prop("disabled")===!0?$("#confirmpay-button-submit").prop("disabled",!1):$("#confirmpay-button-submit").prop("disabled")===!1&&$("#confirmpay-button-submit").prop("disabled",!0)}),$("[data-action='ProcessPayment']").on("click",Checkout.EventHandlers.processPayment)},EventHandlers:{expandCouponPanel:function(a){$(a.currentTarget).closest(".row").fadeOut(function(){$("#coupon-panel").slideDown()})},emailAddressKeyUp:function(){$("#email-exists-message").slideUp(),$("#RegistrationEmailAddress").closest(".form-group").removeClass("has-success has-info has-warning has-error has-feedback").find(".glyphicon").remove(),Checkout.Storage.EMailAvailable=!1},domainKeyUp:function(){$("#domain-exists-message").slideUp(),$("#RegistrationSubdomain").closest(".form-group").removeClass("has-success has-info has-warning has-error has-feedback").find(".glyphicon").remove(),Checkout.Storage.DomainAvailable=!1},checkEmailAvailable:function(){var a={username:$("#RegistrationEmailAddress").val()};$.ajax({url:API.Locations.CheckEmail,data:a,beforeSend:function(){$("#RegistrationEmailAddress").closest(".form-group").removeClass("has-success has-info has-warning has-error has-feedback").find(".glyphicon").remove(),$("#RegistrationEmailAddress").closest(".form-group").addClass("has-feedback has-info").append('<span class="glyphicon glyphicon-refresh spinning form-control-feedback" aria-hidden="true"></span>'),$("#step-billing-submit").prop("disabled",!0)}}).success(function(a,b){Checkout.Storage.EMailAvailable=!1,$("#email-exists-message [data-content='EmailAddress']").text(a.email),$("#email-exists-message").slideDown(),$("#RegistrationEmailAddress").closest(".form-group").removeClass("has-success has-info has-warning has-error has-feedback").find(".glyphicon").remove(),$("#RegistrationEmailAddress").closest(".form-group").addClass("has-warning has-feedback").append('<span class="glyphicon glyphicon-warning-sign form-control-feedback" aria-hidden="true"></span>')}).error(function(a){404===a.status?($("#RegistrationEmailAddress").closest(".form-group").removeClass("has-success has-info has-warning has-error has-feedback").find(".glyphicon").remove(),Checkout.Storage.EMailAvailable=!0,$("#RegistrationEmailAddress").closest(".form-group").addClass("has-success has-feedback").append('<span class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true"></span>'),$("#step-billing-submit").prop("disabled",!1)):Framework.UI.NotificationBanner.fire({type:"error"})})},checkDomainAvailable:function(){var a=$("#RegistrationSubdomain").val(),b=Checkout.Templates.domain({subdomain:a}),c={FQDN:b};$.ajax({url:API.Locations.CheckDomain,data:c,beforeSend:function(){$("#RegistrationSubdomain").closest(".form-group").removeClass("has-success has-info has-warning has-error has-feedback").find(".glyphicon").remove(),$("#RegistrationSubdomain").closest(".form-group").addClass("has-feedback has-info").append('<span class="glyphicon glyphicon-refresh spinning form-control-feedback" aria-hidden="true"></span>'),$("#step-subdomain-submit").prop("disabled",!0)}}).success(function(b,c){Checkout.Storage.DomainAvailable=!1,$("#RegistrationSubdomain").closest(".form-group").removeClass("has-success has-info has-warning has-error has-feedback").find(".glyphicon").remove(),$("#RegistrationSubdomain").closest(".form-group").addClass("has-error has-feedback").append('<span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"></span>'),$("#step-subdomain-submit").prop("disabled",!0),$("#domain-exists-message [data-content='Subdomain']").text(a),$("#domain-exists-message").slideDown()}).error(function(a){404===a.status&&(Checkout.Storage.DomainAvailable=!0,$("#RegistrationSubdomain").closest(".form-group").removeClass("has-success has-info has-warning has-error has-feedback").find(".glyphicon").remove(),$("#RegistrationSubdomain").closest(".form-group").addClass("has-success has-feedback").append('<span class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true"></span>'),$("#step-subdomain-submit").prop("disabled",!1))})},selectPricingPlan:function(a){},processPayment:function(a){if(a.preventDefault(),"Stripe"!==Checkout.Storage.PaymentGateway.id)throw"Could not find payment gateway.";Stripe.configure(),Stripe.fire()}},Templates:{domain:function(a){var b="",c=a.subdomain,d=".usebuild.co";return b=c+d},printPaymentLine:function(a){console.log(a);var b,c,d,e,f="",g="",h="",i="";b=a.type||"",d=a.value||"",g=a.classValue||"",c=a.label||"",h=a.classLabel||"",e=a.class||"",i=a.couponType||"amount";var j=Checkout.Storage.Currency.symbol;return f+='<tr class="payment-line payment-line-'+b+" "+e+'" data-type="'+b+'">',f+='<td class="payment-line-label '+h+'">',f+='<span data-content="LineName">'+c+"</span>",f+="</td>",f+='<td class="payment-line-value '+g+'">',"amount"===i?(f+='<span data-content="CurrencySymbol">'+j+"</span>",f+='<span data-content="LineValue">'+d+"</span>"):"percentage"===i&&(f+='<span data-content="LineValue">'+d+"</span>",f+="<span>%</span>"),f+="</td>",f+="</tr>"},printPricingPlan:function(a){var b,c="",d=a.id,e=a.name,f=a.interval,g=new Number(a.amount/100).toFixed(2),h=a.metadata.description,i=a.metadata.tagline;return"usd"===a.currency&&(b="$"),c+='<div class="pricingplan" data-id="'+d+'">',c+='<div class="pricingplan-title">',c+="<span>"+e+"</span>",c+="</div>",c+='<div class="pricingplan-price-container">',c+='<div class="pricingplan-price">',c+='<span class="pricingplan-price-symbol">'+b+'</span><span class="pricingplan-price-amount">'+g+"</span>",c+="</div>",c+='<span class="pricingplan-price-permonth">per '+f+"</span>",c+="</div>",c+='<div class="pricingplan-description">',c+="<p>"+h+"</p>",c+="</div>",c+='<div class="pricingplan-action">',c+='<p class="pricingplan-action-description">'+i+"</p>",c+='<button type="button" data-action="SelectPricingPlan" class="pricingplan-action-button btn btn-primary btn-block">Choose this Plan</button>',c+="</div>",c+="</div>"}},reset:function(){Checkout.Storage.TemplateID=Framework.Utilities.getQueryStringVars().templateid,Checkout.Storage.ReferralID=Framework.Utilities.getQueryStringVars().referralid,Checkout.Storage.BillingAddress=null,Checkout.Storage.PaymentGateway=Stripe,Checkout.Storage.PaymentGateway.Storage.Plans=null,Checkout.Storage.PaymentGateway.API.getPlans(),Checkout.Forms.validate(),Checkout.addEventListeners(),$(function(){$("#RegistrationBirthDate").datetimepicker({useCurrent:!1,format:"YYYY/MM/DD",viewMode:"years"})})}};$(document).ready(function(){$.crs()}),$(window).load(function(){Framework.UI.loadingOverlay.hide()}),Stripe.reset(),Checkout.reset();
//# sourceMappingURL=induction-2.js.map