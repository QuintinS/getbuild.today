(function(n){n.jscroll={defaults:{debug:!1,autoTrigger:!0,autoTriggerUntil:!1,loadingHtml:"<small>Loading...<\/small>",padding:0,nextSelector:"a:last",contentSelector:"",pagingSelector:"",callback:!1}};var t=function(t,i){function d(){var t=n(r.loadingHtml).filter("img").attr("src"),i;t&&(i=new Image,i.src=t)}function c(){t.find(".jscroll-inner").length||t.contents().wrapAll('<div class="jscroll-inner" />')}function l(n){var t;r.pagingSelector?t=n.closest(r.pagingSelector).hide():(t=n.parent().not(".jscroll-inner,.jscroll-added").addClass("jscroll-next-parent").hide(),t.length||n.wrap('<div class="jscroll-next-parent" />').parent().hide())}function f(){return u.unbind(".jscroll").removeData("jscroll").find(".jscroll-inner").children().unwrap().filter(".jscroll-added").children().unwrap()}function a(){c();var n=t.find("div.jscroll-inner").first(),o=t.data("jscroll"),i=parseInt(t.css("borderTopWidth")),h=isNaN(i)?0:i,l=parseInt(t.css("paddingTop"))+h,a=s?u.scrollTop():t.offset().top,v=n.length?n.offset().top:0,f=Math.ceil(a-v+u.height()+l);if(!o.waiting&&f+r.padding>=n.outerHeight())return e("info","jScroll:",n.outerHeight()-f,"from bottom. Loading next request..."),y()}function g(n){return n=n||t.data("jscroll"),n&&n.nextHref?(v(),!0):(e("warn","jScroll: nextSelector not found - destroying"),f(),!1)}function v(){var n=t.find(r.nextSelector).first();r.autoTrigger&&(r.autoTriggerUntil===!1||r.autoTriggerUntil>0)?(l(n),b.height()<=h.height()&&a(),u.unbind(".jscroll").bind("scroll.jscroll",function(){return a()}),r.autoTriggerUntil>0&&r.autoTriggerUntil--):(u.unbind(".jscroll"),n.bind("click.jscroll",function(){return l(n),y(),!1}))}function y(){var u=t.find("div.jscroll-inner").first(),i=t.data("jscroll");return i.waiting=!0,u.append('<div class="jscroll-added" />').children(".jscroll-added").last().html('<div class="jscroll-loading">'+r.loadingHtml+"<\/div>"),t.animate({scrollTop:u.outerHeight()},0,function(){u.find("div.jscroll-added").last().load(i.nextHref,function(u,o){if(o==="error")return f();var s=n(this).find(r.nextSelector).first();i.waiting=!1;i.nextHref=s.attr("href")?n.trim(s.attr("href")+" "+r.contentSelector):!1;n(".jscroll-next-parent",t).remove();g();r.callback&&r.callback.call(this);e("dir",i)})})}function e(n){var i,t;if(r.debug&&typeof console=="object"&&(typeof n=="object"||typeof console[n]=="function"))if(typeof n=="object"){i=[];for(t in n)typeof console[t]=="function"?(i=n[t].length?n[t]:[n[t]],console[t].apply(console,i)):console.log.apply(console,i)}else console[n].apply(console,Array.prototype.slice.call(arguments,1))}var o=t.data("jscroll"),p=typeof i=="function"?{callback:i}:i,r=n.extend({},n.jscroll.defaults,p,o||{}),s=t.css("overflow-y")==="visible",w=t.find(r.nextSelector).first(),h=n(window),b=n("body"),u=s?h:t,k=n.trim(w.attr("href")+" "+r.contentSelector);return t.data("jscroll",n.extend({},o,{initialized:!0,waiting:!1,nextHref:k})),c(),d(),v(),n.extend(t.jscroll,{destroy:f}),t};n.fn.jscroll=function(i){return this.each(function(){var r=n(this),u=r.data("jscroll"),f;u&&u.initialized||(f=new t(r,i))})}})(jQuery);